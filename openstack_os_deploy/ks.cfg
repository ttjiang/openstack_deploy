# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
url --url="ftp://192.168.1.1/pub"
lang en_US.UTF-8
keyboard us
#network --onboot yes  
rootpw  --iscrypted $6$ATHwHDpTWYAMB/nI$g5c.jpNNtIpjqJb3H39iadaEg7bdlf/xLgcSMs5JhkaKxChTK.Q20fnco8LJh.eNvjLlJLod0paVG1F8BZSnP0
firewall --disabled
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone Asia/Shanghai
bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#clearpart --all --drives=vda


#part /boot --fstype=ext4 --size=500
#part swap --grow --maxsize=2368 --size=1184
#part / --fstype=ext4 --grow --maxsize=51200 --size=1024
clearpart --all --initlabel                                   
part /boot --fstype="ext4" --size=100                        
part swap --fstype="swap" --size=2048                       
part / --fstype="ext4" --grow --size=1

reboot

%packages
@base
@chinese-support
@client-mgmt-tools
@console-internet
@core
@debugging
@basic-desktop
@desktop-platform
@directory-client
@ftp-server
@general-desktop
@graphical-admin-tools
@hardware-monitoring
@input-methods
@internet-browser
@java-platform
@kde-desktop
@large-systems
@network-file-system-client
@performance
@perl-runtime
@server-platform
@server-platform-devel
@server-policy
@virtualization
@virtualization-client
@virtualization-platform
@virtualization-tools
@x11
mtools
pax
python-dmidecode
oddjob
sgpio
genisoimage
wodim
qt-mysql
certmonger
pam_krb5
krb5-workstation
perl-DBD-SQLite
libvirt-java
%end

%post --nochroot

echo "
DEVICE=eth0
BOOTPROTO=none
NM_CONTROLLED=yes
ONBOOT=yes
TYPE=Ethernet
IPADDR=10.1.81.139
NETMASK=255.255.252.0
GATEWAY=10.1.80.254
DNS1=8.8.8.8
IPV6INIT=no
USERCTL=no
" > /mnt/sysimage/etc/sysconfig/network-scripts/ifcfg-eth0

echo "(@-@) (@_@)" >> /mnt/sysimage/etc/hosts
echo "myip myhostname" >> /mnt/sysimage/etc/hosts

touch /mnt/sysimage/etc/yum.repos.d/openstack.repo
echo "
[openstack]
name=openstack
baseurl=ftp://127.0.0.1/openstack-repo/openstack-packages
enabled=1
gpgcheck=0
" > /mnt/sysimage/etc/yum.repos.d/openstack.repo

mkdir -p /mnt/sysimage/opt/openstack

touch /mnt/sysimage/opt/openstack/start.sh
echo "
yum install -y puppet facter
echo \"listen = true\" >> /etc/puppet/puppet.conf
echo \"PUPPET_SERVER = (@_@)\" >> /etc/sysconfig/puppet
touch /etc/puppet/namespaceauth.conf
echo \"[puppetrunner]\" > /etc/puppet/namespaceauth.conf
echo \"allow *\" >> /etc/puppet/namespaceauth.conf
sed -i '\$d' /etc/puppet/auth.conf
sed -i '\$d' /etc/puppet/auth.conf
echo \"
path /run
method save
allow *
path /
auth any 
\" >> /etc/puppet/auth.conf
/etc/init.d/puppet stop
puppetd --server=(@_@)
chkconfig puppet on
ntpdate (@-@)
" > /mnt/sysimage/opt/openstack/start.sh

echo "sh /opt/openstack/start.sh" >> /mnt/sysimage/etc/rc.local
